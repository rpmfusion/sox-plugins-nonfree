Adding support for --without-lpc10

From: Alec Leamas <leamas.alec@gmail.com>


---

 configure    |   41 +++++++++++++++++++++------------
 configure.ac |   73 +++++++++++++++++++++++++++++++++-------------------------
 2 files changed, 68 insertions(+), 46 deletions(-)


diff --git a/configure b/configure
index c063f96..b326b3d 100755
--- a/configure
+++ b/configure
@@ -728,9 +728,9 @@ STATIC_OGG_VORBIS_FALSE
 STATIC_OGG_VORBIS_TRUE
 HAVE_OGG_VORBIS_FALSE
 HAVE_OGG_VORBIS_TRUE
-LIBLPC10_LIBADD
 EXTERNAL_LPC10_FALSE
 EXTERNAL_LPC10_TRUE
+LIBLPC10_LIBADD
 LIBGSM_LIBADD
 EXTERNAL_GSM_FALSE
 EXTERNAL_GSM_TRUE
@@ -907,6 +907,7 @@ enable_dl_mad
 with_id3tag
 with_lame
 enable_dl_lame
+with_lpc10
 with_oggvorbis
 with_flac
 enable_dl_amrwb
@@ -927,7 +928,6 @@ with_oss
 with_sunaudio
 with_mp3
 with_gsm
-with_lpc10
 enable_symlinks
 '
       ac_precious_vars='build_alias
@@ -1607,6 +1607,7 @@ Optional Packages:
   --without-mad           Don't try to use MAD (MP3 Audio Decoder)
   --without-id3tag        Don't try to use id3tag
   --without-lame          Don't try to use LAME (LAME Ain't an MP3 Encoder)
+  --without-lpc10         Don't try to use lpc10
   --with-oggvorbis=dyn    load oggvorbis dynamically
   --with-flac=dyn         load flac dynamically
   --with-amrwb=dyn        load amrwb dynamically
@@ -14156,9 +14157,18 @@ fi
 
 
 
-# Check for liblpc10
-found_liblpc10=yes
-for ac_header in lpc10.h
+using_lpc10=no
+
+# Check whether --with-lpc10 was given.
+if test "${with_lpc10+set}" = set; then :
+  withval=$with_lpc10;
+fi
+
+if test "$with_lpc10" != no; then
+    using_lpc10=yes
+     # Check for liblpc10
+    found_liblpc10=yes
+    for ac_header in lpc10.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "lpc10.h" "ac_cv_header_lpc10_h" "$ac_includes_default"
 if test "x$ac_cv_header_lpc10_h" = xyes; then :
@@ -14227,12 +14237,14 @@ else
   found_liblpc10=no
 fi
 
-if test "$found_liblpc10" = yes; then
+    if test "$found_liblpc10" = yes; then
 
 $as_echo "#define EXTERNAL_LPC10 1" >>confdefs.h
 
-else
+    else
     LIBLPC10_LIBADD=../lpc10/liblpc10.la
+    fi
+
 fi
  if test x$found_liblpc10 = xyes; then
   EXTERNAL_LPC10_TRUE=
@@ -14244,8 +14256,6 @@ fi
 
 
 
-
-
 # Check for Ogg Vorbis
 
 # Check whether --with-oggvorbis was given.
@@ -16544,7 +16554,7 @@ as_fn_error $? "invalid selection --with-lpc10=$with_lpc10
 See \`config.log' for more details" "$LINENO" 5; }
   fi
   if test _$with_lpc10 != _no; then
-
+    "$using_lpc10"=yes
     if test _$with_lpc10 != _ -a $using_lpc10 = no; then
       { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
@@ -17085,7 +17095,10 @@ $as_echo "make use of $ac_cv_header_stdint in $ac_stdint_h $ac_cv_stdint_result"
 ac_config_commands="$ac_config_commands $ac_stdint_h"
 
 
-ac_config_files="$ac_config_files Makefile src/Makefile libgsm/Makefile lpc10/Makefile msvc9/Makefile msvc10/Makefile sox.pc"
+if test "$using_lpc10" = yes; then
+    lpc10_makefile=lpc10/Makefile
+fi
+ac_config_files="$ac_config_files Makefile src/Makefile libgsm/Makefile $lpc10_makefile msvc9/Makefile msvc10/Makefile sox.pc"
 
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -18313,7 +18326,7 @@ do
     "Makefile") CONFIG_FILES="$CONFIG_FILES Makefile" ;;
     "src/Makefile") CONFIG_FILES="$CONFIG_FILES src/Makefile" ;;
     "libgsm/Makefile") CONFIG_FILES="$CONFIG_FILES libgsm/Makefile" ;;
-    "lpc10/Makefile") CONFIG_FILES="$CONFIG_FILES lpc10/Makefile" ;;
+    "$lpc10_makefile") CONFIG_FILES="$CONFIG_FILES $lpc10_makefile" ;;
     "msvc9/Makefile") CONFIG_FILES="$CONFIG_FILES msvc9/Makefile" ;;
     "msvc10/Makefile") CONFIG_FILES="$CONFIG_FILES msvc10/Makefile" ;;
     "sox.pc") CONFIG_FILES="$CONFIG_FILES sox.pc" ;;
diff --git a/configure.ac b/configure.ac
index ae249bc..3277172 100644
--- a/configure.ac
+++ b/configure.ac
@@ -389,19 +389,25 @@ AC_SUBST(LIBGSM_LIBADD)
 
 
 
-# Check for liblpc10
-found_liblpc10=yes
-AC_CHECK_HEADERS(lpc10.h, ,
+dnl Check for liblpc10 library.
+using_lpc10=no
+AC_ARG_WITH(lpc10,
+    AC_HELP_STRING([--without-lpc10], [Dont try to use lpc10]))
+if test "$with_lpc10" != no; then
+    using_lpc10=yes
+     # Check for liblpc10
+    found_liblpc10=yes
+    AC_CHECK_HEADERS(lpc10.h, ,
     [AC_CHECK_HEADERS(lpc10.h, ,found_liblpc10=no)])
     AC_CHECK_LIB(lpc10, create_lpc10_encoder_state, LPC10_LIBS="$LPC10_LIBS -llpc10", found_liblpc10=no)
-if test "$found_liblpc10" = yes; then
+    if test "$found_liblpc10" = yes; then
     AC_DEFINE(EXTERNAL_LPC10, 1, [Define if you are using an external LPC10 library])
-else
+    else
     LIBLPC10_LIBADD=../lpc10/liblpc10.la
+    fi
+    AC_SUBST(LIBLPC10_LIBADD)
 fi
 AM_CONDITIONAL(EXTERNAL_LPC10, test x$found_liblpc10 = xyes)
-AC_SUBST(LIBLPC10_LIBADD)
-
 
 
 # Check for Ogg Vorbis
@@ -559,7 +565,7 @@ AC_OPTIONAL_FORMAT(gsm, GSM)
 
 # LPC10 format depends on liblpc10
 # No need to check; LPC10 is always found
-AC_OPTIONAL_FORMAT(lpc10, LPC10)
+AC_OPTIONAL_FORMAT(lpc10, LPC10, ["$using_lpc10"=yes])
 
 
 
@@ -591,7 +597,10 @@ AM_CONDITIONAL(STATIC_LIBSOX_ONLY, test "$enable_shared" = "no" -a "$enable_stat
 
 dnl Generate output files.
 AX_CREATE_STDINT_H(src/soxstdint.h)
-AC_CONFIG_FILES(Makefile src/Makefile libgsm/Makefile lpc10/Makefile msvc9/Makefile msvc10/Makefile sox.pc)
+if test "$using_lpc10" = yes; then
+    lpc10_makefile=lpc10/Makefile
+fi
+AC_CONFIG_FILES(Makefile src/Makefile libgsm/Makefile $lpc10_makefile msvc9/Makefile msvc10/Makefile sox.pc)
 AC_OUTPUT
 
 if test "$using_gsm" != "no"; then
